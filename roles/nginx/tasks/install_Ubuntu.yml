---

- name: Add nginx.org signing key
  apt_key:
    url: https://nginx.org/keys/nginx_signing.key
    state: present
  when: nginx_use_nginxorg_repo    

- name: Add nginx.org apt repository for {{ ansible_distribution_release }} | STABLE
  apt_repository:
    repo: deb http://nginx.org/packages/ubuntu/ {{ ansible_distribution_release }} nginx
    state: present
  when: 
    - ansible_distribution_release == "xenial" or ansible_distribution_release == "trusty" or ansible_distribution_release == "artful"
    - nginx_use_nginxorg_repo
    - not nginx_use_nginxorg_mainline

- name: Add nginx.org apt repository for {{ ansible_distribution_release }} | MAINLINE
  apt_repository:
    repo: deb http://nginx.org/packages/mainline/ubuntu/ {{ ansible_distribution_release }} nginx
    state: present
  when: 
    - ansible_distribution_release == "xenial" or ansible_distribution_release == "trusty" or ansible_distribution_release == "artful"   
    - nginx_use_nginxorg_repo
    - nginx_use_nginxorg_mainline

- name: Install nginx.
  apt: name=nginx state=present

- name: Ensure nginx is running and will start on boot. 
  service: name=nginx state=started enabled=yes